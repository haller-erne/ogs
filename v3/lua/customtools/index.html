
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://haller-erne.github.io/ogs/v3/lua/customtools/">
      
      
        <link rel="prev" href="../webserver/">
      
      
        <link rel="next" href="../../../libs/lua-ads/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.20">
    
    
      
        <title>Lua custom tools - OGS Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="OGS Documentation" class="md-header__button md-logo" aria-label="OGS Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OGS Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lua custom tools
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="OGS Documentation" class="md-nav__button md-logo" aria-label="OGS Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    OGS Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tool configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tool configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/remote-tool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Tool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Open Protocol Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Open Protocol Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/openprotocol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/openprotocol/nexo.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nexo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/openprotocol/sys350.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CS351/KE350
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/openprotocol/gwk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GWK Operator+
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/openprotocol/sturtevant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sturtevant 400mp/TCVe2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/openprotocol/hstechnik.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HS-Technik NutBee
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/openprotocol/ngineric.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    n-gineric
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Scripting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Scripting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LUA interfaces
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            LUA interfaces
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eventlog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eventlog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webbrowser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web browsers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webserver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webserver (and REST API)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    LUA custom tools
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    LUA custom tools
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lua-driver-anatomy-and-driver-registration" class="md-nav__link">
    <span class="md-ellipsis">
      LUA driver anatomy and driver registration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simplified-api" class="md-nav__link">
    <span class="md-ellipsis">
      Simplified API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simplified API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tool-driver-interface-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Tool driver interface functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-driver-formatting-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Tool driver formatting functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-driver-miscelaneous-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Tool driver miscelaneous functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LUA helper libraries
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            LUA helper libraries
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/lua-ads/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADS communication (TwinCat, Nexeed, Beckhoff)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/lua-opcua/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpcUA communication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/lua-modbus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modbus/TCP/UDP communication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/lua-hid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB HID Devices (Buttons, Arduino, etc.)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/lua-dpapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Protection API (safe secrets storage)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../libs/lua-net/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LUA network helpers (REST/OpenAPI)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging LUA Scripts
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lua-driver-anatomy-and-driver-registration" class="md-nav__link">
    <span class="md-ellipsis">
      LUA driver anatomy and driver registration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simplified-api" class="md-nav__link">
    <span class="md-ellipsis">
      Simplified API
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simplified API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tool-driver-interface-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Tool driver interface functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-driver-formatting-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Tool driver formatting functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tool-driver-miscelaneous-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Tool driver miscelaneous functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>LUA custom tools</h1>

<h2 id="overview"><a class="toclink" href="#overview">Overview</a></h2>
<p>OGS has an interface to add additional tool drivers by adding Windows-DLLs to the <code>[TOOL_DLL]</code> section in <code>station.ini</code>. To make it easier to implement custom tool drivers, OGS provides <code>heLuaTool.dll</code> - this allows implementing tool drivers in pure LUA. </p>
<p>To implement a tool driver in LUA, usually the following steps are required:</p>
<ul>
<li>Add/enable <code>heLuaTool.dll</code> in the <code>[TOOL_DLL]</code>-section in <code>station.ini</code></li>
<li>Create a custom LUA tool driver file (see bvelow) and add it to your projects configuration (add the file name to the <code>requires = {}</code>-list in <code>config.lua</code>)</li>
<li>Add one or more channels to <code>station.ini</code> (in the <code>[CHANNELS]</code>-section in <code>station.ini</code>). Note, that the section name assigned to the tool number must start with <code>LuaTool_</code>!</li>
<li>Add the specified section to <code>station.ini</code> and set <code>Driver=heLuaTool</code> and <code>TYPE=</code> to the tool driver name as defined in your custom LUA tool driver</li>
<li>Also add the tool/channel parameters as required by your LUA driver in the specified section.</li>
<li>To allow using the custom tools, add then to the <code>custom</code> section in the heOpCfg tools editor tab. Also add new tool/action properties as required. Make sure to use the same tool/channel numbers as defined in your <code>station.ini</code>. </li>
</ul>
<p>Here is an excerpt from <code>station.ini</code> showing the relevant entries:</p>
<div class="highlight"><span class="filename">station.ini</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">[TOOL_DLL]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="na">heLuaTool.dll</span><span class="o">=</span><span class="s">1</span><span class="w"> </span><span class="c1">; (1)!</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">[CHANNELS]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="na">20</span><span class="o">=</span><span class="s">LuaTool_MyCustomTool</span><span class="w"> </span><span class="c1">; (2)!</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">[LuaTool_MyCustomTool]</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="na">Driver</span><span class="o">=</span><span class="s">heLuaTool</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="na">TYPE</span><span class="o">=</span><span class="s">MyCustomTool</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1">; additional LUA too specific parameters can follow</span>
</code></pre></div>
<ol>
<li>
<p>Load and enable the generic LUA tool interface DLL</p>
</li>
<li>
<p>Create the channel/tool 20 and assign the configuration section <code>LuaTool_MyCustomTool</code>. Make sure to start the section name with <code>LuaTool_</code>, else the Lua tool DLL will not get loaded for this section!</p>
</li>
</ol>
<p>To implement a tool driver using LUA, there are basically two options:</p>
<ol>
<li>Use the low-level API provided by <code>heLuaTool.dll</code>.</li>
<li>Use the <a href="#simplified-api">Simplified API</a> </li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>It is highly recommended to use the <a href="#simplified-api">Simplified API</a> described below to implement custom tool drivers - using the low-level API requires in-depth knowledge of the API to not break other drivers!</p>
</div>
<h2 id="lua-driver-anatomy-and-driver-registration"><a class="toclink" href="#lua-driver-anatomy-and-driver-registration">LUA driver anatomy and driver registration</a></h2>
<p>The LUA tool driver must be implemented as LUA module, returning the module table. Another requirement is to have the tool driver type as member <code>type</code> in the module table (this is how <code>station.ini</code> and the actual LUA driver is linked). </p>
<p>In addition to this, it is <strong>required</strong> to register the driver module with OGS by adding the tool driver type and its module to the global <code>lua_known_tool_types</code> table - best practice is to use the function <code>register_tool</code> from the <code>lua_tool_helpers</code>-module.</p>
<p>Here is a skeleton of a driver module:</p>
<div class="highlight"><span class="filename">my_custom__driver.lua</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">-- My custom LUA tool driver</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kd">local</span> <span class="n">_M</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;MyCustomTool&#39;</span><span class="p">,</span>     <span class="c1">-- type id (must match the DRIVER= in INI file)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="p">}</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1">-- register this tool with OGS (heLuaTool.dll)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="kd">local</span> <span class="n">helpers</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;lua_tool_helpers&#39;</span><span class="p">)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">helpers</span><span class="p">.</span><span class="n">register_tool</span><span class="p">(</span><span class="n">_M</span><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1">-- return the module</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="kr">return</span> <span class="n">_M</span>
</code></pre></div>
<h2 id="simplified-api"><a class="toclink" href="#simplified-api">Simplified API</a></h2>
<p>The simplified custom tool driver API uses five states and associated transitions to implement the tool behaviour. Each transitions can be implemented in the custom tool LUA code to provide the custom functionality - if not implemented, the transition is executed without a custom action.</p>
<p>Here is the state diagram for the behaviour:</p>
<pre class="mermaid"><code>stateDiagram-v2
    [*] --&gt; active: init()
    inactive --&gt; active: activate()
    active --&gt; inactive: deactivate()
    active --&gt; enabled: enable()
    enabled --&gt; enabled: execute()
    enabled --&gt; disabled: disable()
    disabled --&gt; enabled: enable()
    disabled --&gt; inactive: deactivate()</code></pre>
<p>The <code>active</code> state is entered whenever OGS has an active operation for this tool. While the tool is <code>active</code>, it might switch back and forth between <code>disabled</code> and <code>enabled</code> (e.g. depending on any external enable/release condition).  After a tool result has been received, the state typically switches back to <code>inactive</code> (another tool is active or workflow has finished). </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Use the <code>lua_tool_helpers.lua</code> in your code - this provides helpers for registering the tool driver, flexible default formatting functions and a few handy helpers!</p>
</div>
<h3 id="tool-driver-interface-functions"><a class="toclink" href="#tool-driver-interface-functions">Tool driver interface functions</a></h3>
<p>The actual tool driver implementation is provided by implementing the tool driver interface functions - and return them as members of the module table. Note that each interface has a <code>channel</code> parameter with</p>
<p>A typical implementation would look like the following (adding the <code>_M.init()</code>, the <code>_M.enable()</code> and the the <code>_M.execute()</code> functions):</p>
<div class="highlight"><span class="filename">my_custom__driver.lua</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">-- My custom LUA tool driver</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kd">local</span> <span class="n">_M</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;MyCustomTool&#39;</span><span class="p">,</span>     <span class="c1">-- type id (must match the DRIVER= in INI file)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="p">}</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kd">local</span> <span class="n">helpers</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;lua_tool_helpers&#39;</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c1">-------------------------------------------------------------</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1">-- Tool event: Initialize tool - called once during OGS init </span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c1">-- return &#39;OK&#39; or some error text if the initialization failes.</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="kr">function</span> <span class="nc">_M</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="c1">-- Decode/get my configuration (from station.ini)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="kd">local</span> <span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>        <span class="n">ComPort</span> <span class="o">=</span> <span class="n">channel</span><span class="p">.</span><span class="n">ini_params</span><span class="p">.</span><span class="n">COM_PORT</span><span class="p">,</span>      <span class="c1">-- COM port</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="p">}</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="c1">-- Do whatever is needed to initialize your driver</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="c1">-- ...</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="n">channel</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>         <span class="c1">-- store the channels config data</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="kr">return</span> <span class="s1">&#39;OK&#39;</span>               <span class="c1">-- init successfully done</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="kr">end</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="c1">----------------------------------------------------------------------------</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="c1">-- Tool event: Cyclically called while the tool is enabled</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="c1">-- return the tool task state</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="kr">function</span> <span class="nc">_M</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>    <span class="c1">-- Check for tool finished</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="kd">local</span> <span class="n">ResultData</span> <span class="o">=</span> <span class="n">_M</span><span class="p">.</span><span class="n">GetResultData</span><span class="p">()</span> <span class="c1">-- must be implemented!</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="kr">if</span> <span class="n">ResultData</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>       <span class="c1">-- no data available from the tool</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>        <span class="kr">return</span> <span class="n">channel</span><span class="p">.</span><span class="n">task_state</span>   <span class="c1">-- wait more.</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>    <span class="kr">end</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>    <span class="kr">if</span> <span class="n">ResultData</span><span class="p">.</span><span class="n">Error</span> <span class="kr">then</span>        <span class="c1">-- some error occurred</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        <span class="kr">return</span> <span class="n">lua_task_fault</span>       <span class="c1">-- return an error code</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    <span class="kr">end</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>    <span class="kr">if</span> <span class="n">ResultData</span><span class="p">.</span><span class="n">Data</span> <span class="kr">then</span>         <span class="c1">-- received data</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>        <span class="c1">-- Build a result data table and notify the OGS core </span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>        <span class="kd">local</span> <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>            <span class="n">ResultData</span><span class="p">.</span><span class="n">torque</span><span class="p">,</span>          <span class="c1">-- M1 actual value</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>            <span class="n">ResultData</span><span class="p">.</span><span class="n">angle</span><span class="p">,</span>           <span class="c1">-- M2 actual value</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>            <span class="n">ResultData</span><span class="p">.</span><span class="n">t_min</span><span class="p">,</span>           <span class="c1">-- M1 min</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>            <span class="n">ResultData</span><span class="p">.</span><span class="n">t_max</span><span class="p">,</span>           <span class="c1">-- M1 max</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>            <span class="mf">0.0</span><span class="p">,</span>                        <span class="c1">-- M2 min</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>            <span class="mf">0.0</span>                         <span class="c1">-- M2 max</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>        <span class="p">}</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>        <span class="kd">local</span> <span class="n">error_code</span> <span class="o">=</span> <span class="n">helpers</span><span class="p">.</span><span class="n">get_code_from_limits</span><span class="p">(</span><span class="n">ResultData</span><span class="p">.</span><span class="n">torque</span><span class="p">,</span> <span class="n">ResultData</span><span class="p">.</span><span class="n">t_min</span><span class="p">,</span> <span class="n">ResultData</span><span class="p">.</span><span class="n">t_max</span><span class="p">)</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a>        <span class="n">lua_tool_result_response</span><span class="p">(</span><span class="n">channel</span><span class="p">.</span><span class="n">tool</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;2A&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>        <span class="kr">return</span> <span class="n">lua_task_completed</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>    <span class="kr">end</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>    <span class="kr">return</span> <span class="n">channel</span><span class="p">.</span><span class="n">task_state</span>       <span class="c1">-- wait more.</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="kr">end</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="c1">-------------------------------------------------------------</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="c1">-- Tool event: Called whenever the tool is to be enabled</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a><span class="c1">-- @ output: true|false  - tool enabled/not enabled </span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="c1">--                         (will be called again until enabled!)</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a><span class="kr">function</span> <span class="nc">_M</span><span class="p">.</span><span class="nf">enable</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a>    <span class="kd">local</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">channel</span><span class="p">.</span><span class="n">cfg</span>     <span class="c1">-- access the channel config data</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>    <span class="c1">-- Do whatever is needed</span>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a>    <span class="kr">return</span> <span class="kc">true</span>                 <span class="c1">-- tool is enabled</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a><span class="kr">end</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a><span class="c1">-------------------------------------------------------------</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="c1">-- register this tool with OGS (heLuaTool.dll)</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="n">helpers</span><span class="p">.</span><span class="n">register_tool</span><span class="p">(</span><span class="n">_M</span><span class="p">)</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="c1">-- return the module</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a><span class="kr">return</span> <span class="n">_M</span>
</code></pre></div>
<p>The following functions can be implemented as part of the <code>simple</code> LUA tool driver interface:</p>
<table>
<thead>
<tr>
<th>Function Name</th>
<th>Return Type</th>
<th>Description</th>
<th>Tags</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>init(channel: table)</code></td>
<td><code>result: string</code></td>
<td>Is called once for each tool (channel) registered in <code>station.ini</code> for this driver. The <code>channel</code> table parameter has the <code>channel.tool</code> entry set to the channel/tool number defined in <code>[CHANNELS]</code> (from <code>station.ini</code>) and the <code>channel.ini_params</code> as a table of strings with the complete <code>LuaTool_...</code>-section from <code>station.ini</code>. Return <code>'OK'</code> on successful initialization, else an error message string. <strong>Hint:</strong> The driver can add its own instance data to the <code>channel</code> table for later use.</td>
<td>None</td>
</tr>
<tr>
<td><code>activate(channel: table)</code></td>
<td><code>result: boolean</code></td>
<td>Is called whenever OGS activates a tool (i.e. the workflow switches to an action/operation where this tool is needed). The function is called cyclically until it returns <code>true</code></td>
<td>None</td>
</tr>
<tr>
<td><code>deactivate(channel: table)</code></td>
<td><code>result: boolean</code></td>
<td>Is called whenever OGS deactivates a tool (i.e. the workflow switches to another action/operation). The function is called cyclically until it returns <code>true</code></td>
<td>None</td>
</tr>
<tr>
<td><code>enable(channel: table)</code></td>
<td><code>result: boolean</code></td>
<td>Is called whenever the tool is active and OGS needs to enable a tool. The function is called cyclically until it returns <code>true</code></td>
<td>None</td>
</tr>
<tr>
<td><code>disable(channel: table)</code></td>
<td><code>result: boolean</code></td>
<td>Is called whenever the tool is active and OGS needs to disable a tool (e.g. if some external condition is removed like an external enable signal). The function is called cyclically until it returns <code>true</code></td>
<td>None</td>
</tr>
<tr>
<td><code>execute(channel: table)</code></td>
<td><code>result: number</code></td>
<td>Is called while the tool is enabled to check the tool, if it has finished. If so, the global function <code>lua_tool_result_response</code> should be called (to send result data to the OGS core) and a value of <code>lua_task_completed</code> should be returned. If the function should be called again (tool not yet finished), return <code>channel.task_state</code>. In case of an error, return <code>lua_task_fault</code> or some of the other error codes (see <code>lua_tool.lua</code> in the <code>lualibs</code> folder for details)</td>
<td>None</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To cyclically poll a tool driver (e.g. to implement network communication), implement the modules <code>_M.poll()</code> function (low-level API) or register a global StatePoll function (use <code>StatePollFunctions.add()</code> and use the (low-level API) _M.channels table to iterate your drivers registered channels).</p>
</div>
<h3 id="tool-driver-formatting-functions"><a class="toclink" href="#tool-driver-formatting-functions">Tool driver formatting functions</a></h3>
<p>To allow the LUA tool drivers to correctly present their values on the OGS user interface screen, the following module interface functions can be used:</p>
<ul>
<li>_M.get_tool_units(): Defines the unit texts and number of digits used for formatting the tool results in the action/operation list pane. </li>
<li>_M.get_tool_result_string(): Defines the main (large) result text shown in the bottom right corner result pane.</li>
<li>_M.get_footer_string(): Defines the footer string shown in the bottom right corner result pane.</li>
<li>_M.get_prg_string(): Defines the program string shown in the upper right corner of the bottom right corner result pane.</li>
</ul>
<p>As the functions are part of the low-level API, they are passed the the tool number instead of the channel table (as with the simple API interface). As the LUA tool driver infrastructure keeps a list of registered channels in each tool drivers module table, this can be used to access the channel table from a given tool as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">-- Get the channel table from a given tool number</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">_M</span><span class="p">.</span><span class="n">get_channel_from_tool</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="kd">local</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">_M</span><span class="p">.</span><span class="n">channels</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="kr">return</span> <span class="n">channel</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kr">end</span>
</code></pre></div>
<p>The following functions can be implemented for formatting:</p>
<table>
<thead>
<tr>
<th>Function Name</th>
<th>Return Type</th>
<th>Description</th>
<th>Tags</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>get_tool_units(tool: number)</code></td>
<td><code>unit1: string, unit2: string, decimals1: number, decimals2: number</code></td>
<td>Returns the unit text and number of decimals used for showing the result values in the result list.</td>
<td>None</td>
</tr>
<tr>
<td><code>get_tool_result_string(tool: number)</code></td>
<td><code>text: string</code></td>
<td>Returns the center text shown in the result pane.</td>
<td>None</td>
</tr>
<tr>
<td><code>get_footer_string(tool: number)</code></td>
<td><code>text: string</code></td>
<td>Returns the footer text for the result pane.</td>
<td>None</td>
</tr>
<tr>
<td><code>get_prg_string(tool: number)</code></td>
<td><code>text: string</code></td>
<td>Returns the program name/number text for the result pane (the top right text).</td>
<td>None</td>
</tr>
</tbody>
</table>
<p>The <code>lua_tool_helpers</code> module provides a reusable implementation for formatting text by specifying a format string - and a helper function to read the format strings from the <code>station.ini</code> tool driver sections.</p>
<p>Here is some sample code on how to use it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">local</span> <span class="n">helpers</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;lua_tool_helpers&#39;</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kd">local</span> <span class="n">_M</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;MyLuaTool&#39;</span><span class="p">,</span>     <span class="c1">-- type identifier (as in INI file)</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="p">}</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c1">-------------------------------------------------------------</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1">-- Initialize the driver and read the parameter section</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="kr">function</span> <span class="nc">_M</span><span class="p">.</span><span class="nf">init</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="c1">-- local (tool instance specific) parameters</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="kd">local</span> <span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>        <span class="c1">-- Initialize the parameters for formatting</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>        <span class="n">fmt</span> <span class="o">=</span> <span class="n">helpers</span><span class="p">.</span><span class="n">read_fmt_config</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    <span class="p">}</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="n">channel</span><span class="p">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="kr">return</span> <span class="s1">&#39;OK&#39;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="kr">end</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="c1">-------------------------------------------------------------</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="c1">-- Get the tool specific measurement units </span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="c1">-- @param tool: channel number as configured in station.ini</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="c1">-- @return:  applicable only for the first two values (from 6)</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="n">_M</span><span class="p">.</span><span class="n">get_tool_units</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>    <span class="kd">local</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">_M</span><span class="p">.</span><span class="n">channels</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>    <span class="kr">return</span> <span class="n">helpers</span><span class="p">.</span><span class="n">get_tool_units</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="n">fmt</span><span class="p">)</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="kr">end</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="c1">-- Get the tool specific result string</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="n">_M</span><span class="p">.</span><span class="n">get_tool_result_string</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>    <span class="kd">local</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">_M</span><span class="p">.</span><span class="n">channels</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>    <span class="kr">return</span> <span class="n">helpers</span><span class="p">.</span><span class="n">get_tool_result_string</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="n">fmt</span><span class="p">)</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="kr">end</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="c1">-- Get the tool specific footer string</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="n">_M</span><span class="p">.</span><span class="n">get_footer_string</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>    <span class="kd">local</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">_M</span><span class="p">.</span><span class="n">channels</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>    <span class="kr">return</span> <span class="n">helpers</span><span class="p">.</span><span class="n">get_footer_string</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="n">fmt</span><span class="p">)</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="kr">end</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="c1">-- Get the tool specific program name</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="n">_M</span><span class="p">.</span><span class="n">get_prg_string</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>    <span class="kd">local</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">_M</span><span class="p">.</span><span class="n">channels</span><span class="p">[</span><span class="n">tool</span><span class="p">]</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>    <span class="kr">return</span> <span class="n">helpers</span><span class="p">.</span><span class="n">get_prg_string</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">.</span><span class="n">cfg</span><span class="p">.</span><span class="n">fmt</span><span class="p">)</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="kr">end</span>
</code></pre></div>
<h3 id="tool-driver-miscelaneous-functions"><a class="toclink" href="#tool-driver-miscelaneous-functions">Tool driver miscelaneous functions</a></h3>
<p>tbd.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
    
  </body>
</html>