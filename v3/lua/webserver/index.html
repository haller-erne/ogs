<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://haller-erne.github.io/ogs/v3/lua/webserver/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Webserver (and REST API) - OGS Documentation</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Webserver", url: "#_top", children: [
              {title: "Overview", url: "#overview" },
              {title: "Prerequisites", url: "#prerequisites" },
              {title: "Global Webserver table", url: "#global-webserver-table" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../libs/lua-ads/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../libs/lua-ads/" class="btn btn-xs btn-link">
        ADS communication (TwinCat, Nexeed, Beckhoff)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../webbrowser/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../webbrowser/" class="btn btn-xs btn-link">
        Web browsers
      </a>
    </div>
    
  </div>

    

    <h1 id="webserver">Webserver</h1>
<h2 id="overview">Overview</h2>
<p>The OGS runtime uses the Microsoft Windows builtin <a href="https://learn.microsoft.com/en-us/windows/win32/api/_http/">http.sys web server</a> to server static pages and dynamic pages. The dynamic pages are implemented through LUA scripting and makes it possible to flexibly implement web services like OpenAPI / REST services or others.</p>
<p>A typical use case is to provide a REST interface for third-party systems to connect them to OGS, another is to implement backend logic for a single page application web page frontend running inside OGS (see also <a href="../webbrowser.md">OGS Webbrowser LUA interface</a>).</p>
<p>The web server LUA api works by registering LUA callback functions for specific URL prefixes, which are then called by the web server, whenever the given URL is requested from a web client.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>To use the LUA web server API, the web server must be enabled through <code>station.ini</code> (in the <code>[WebServer]</code> section) and the Microsoft <code>http.sys</code> web server must be configured accordingly (a URL reservation must be activated through the <code>netsh http add urlacl ...</code> command).</p>
<p>By default the, installer registers a web endpoint at http://localhost:59990, so the endpoint is only accessible from the local machine and only for a locally logged on user.</p>
<p>To access the web server from the outside, make sure to change the listen address in the <code>station.ini</code> file, the URL reservation through <code>netsh http ...</code> and check the firewall settings. </p>
<h2 id="global-webserver-table">Global Webserver table</h2>
<p>OGS exposes the web server through the global <code>Webserver</code> object. The <code>Webserver</code> object implements the following functions:</p>
<ul>
<li><a href="#regurl">RegUrl</a>: Register a LUA callback function to be called when a specific URL prefix is requested from the web server.</li>
</ul>
<!--
The following functions are also available, but are not fully implemented at the moment:
- [ExecJS_sync](#execjs-sync): 
- [ExecJS_async](#execjs-async):
- [Show](#show): 
- [Hide](#hide): 
- [GetState](#getstate): 
-->

<h3 id="regurl">RegUrl</h3>
<p>The <code>Webserver.RegUrl</code> function registers or unregisters a LUA function to be called whenever the web server receives a request to the given URL prefix.</p>
<pre><code class="language-LUA">fn, err = Webserver.RegUrl(prefix, callbackfn)
</code></pre>
<h4 id="parameters">Parameters</h4>
<ul>
<li>prefix [string]: Path prefix to match against when checking the request URL. Note that this only checks for the path part of the URL (e.g. '/home'). </li>
<li>
<p>callbackfn [function]: LUA function to be called when a web request matches the prefix. The callback function has the following signature:</p>
<pre><code>table = callbackfn(reqpath, reqparams, verb, body)
</code></pre>
<p>Where reqpath [string] is the full request path, (e.g. '/api/items'), reqparams [string] the request parameters (e.g. '?max=10&amp;class=5'), verb [integer] the request type (GET, PUT, POST, DELETE) and body [string] the body (binaty) string value (only for POST and PUT).</p>
<p>The callback function should return a response table with the required parameters to build the http response (optional body).</p>
</li>
</ul>
<h4 id="return-values">Return values</h4>
<p>If the function was executed successfully, the callbackfn is returned as the first return value. Else nil is returned and the second return value has an error message string (wrong parameters or unknown instance).</p>
<h4 id="sample-code">Sample code</h4>
<pre><code class="language-LUA">local function handlerfn(reqpath, reqparams, verb, body)
    -- process the request, return the response object (or nil
    -- if this request is not handled) 
    return nil
end
-- Register a LUA function to be called whenever a web request to /api/lua
-- is made
Browser.RegMsgHandler('/api/lua', handlerfn)
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../../libs/lua-ads/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../../libs/lua-ads/" class="btn btn-xs btn-link">
        ADS communication (TwinCat, Nexeed, Beckhoff)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../webbrowser/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../webbrowser/" class="btn btn-xs btn-link">
        Web browsers
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>